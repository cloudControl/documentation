# MongoSoup

MongoSoup is the first German-based MongoDB cloud hosting solution. Supported by a team of experts from 10genâ€™s first German partner comSysto you can have a running MongoDB database in virtually no time.

## MongoSoup 

The MongoSoup Add-on can be added to any deployment from the cctrlapp command line:

~~~
$ cctrlapp APP_NAME/DEP_NAME addon.add mongosoup.OPTION
~~~

For your OPTION, select one of MongoSoup's plan offerings: small, medium, large, xlarge, dedicated-small, dedicated-medium, dedicated-large, dedicated-xlarge For more information, click [here](https://www.cloudcontrol.com/add-ons/mongosoup).

## For example:

~~~
$ cctrlapp APP_NAME/DEP_NAME addon.add mongosoup.large
~~~

When added, MongoSoup automatically creates a new user account and database in an Amazon EC2 cloud. You can manage your database and data easily from the [web console](https://console.cloudcontrolled.com/) by clicking the MongoSoup add-on entry on your app's deployment page, and you gain immediate access to MongoSoup customer support. Email [support@mongosoup.de](mailto:support@mongosoup.de) with any questions.

## Internal access credentials

Your MongoSoup database connection URI is provided in the CRED_FILE environment variable, a JSON document that stores credentials from your add-on providers. This allows you to avoid hard-coding.

Note: In the event that MongoSoup must update your MongoSoup_URI, you will be notified through the email address you\92ve provided to CloudControl.

MongoSoup's entry in your application CRED_FILE looks like this:

~~~
{
 "mongosoup":{
   "MONGOSOUP_URL":"mongodb://APP_NAME:PASSWORD@dbs001.mongosoup.de//DBNAME",
 }
}
~~~

Your app-name, password and db-name are all automatically generated by cloudControl and MongoSoup.

## Samples

Here are some snippets of code to help you get started:

PHP:

```php
	<?php
	$credfile = file_get_contents($_ENV['CRED_FILE'], false);
	$credentials = json_decode($credfile, true);
	$uri = $credentials["MongoSoup"]["MongoSoup_URL"];
	$m = new Mongo($uri);
	$db = $m->selectDB(myDbName);
	$col = new MongoCollection($db, myCollection);
	$cursor = $col->find();
	foreach ($cursor as $doc) { echo $doc, "</br>"; }
	?> 
```

Java: 

For reading CloudControl credentials you can use the Credentials class as described in [Reading the Credentials](https://www.cloudcontrol.com/dev-center/Guides/Java/Add-on%20credentials) article.

```java
    Credentials credentials = Credentials.getInstance();
	String uriString = credentials.getCredential("url","mongosoup").toString();
	MongoClientURI uri = new MongoClientURI(uriString);
	MongoClient mongo = new MongoClient(uri);
	DB db = mongo.getDB("myDbName"); 
	DBColection collection = db.getCollection("myCollection");
	DBCursor cur = collection.find();
	while(cur.hasNext()){
		DBObject obj = cur.next();
		...
	}
```


Python:

```python
cred_file = open(os.environ["CRED_FILE"])
data = json.load(cred_file)
creds = data['MONGOSOUP']
uriString = str(creds['MONGOSOUP_URL'])
mongo = MongoClient(uriString);
db = mongo['myDbName']
collection = db['myCollection']
for obj in collection.find():
	...   
```

Ruby:

```ruby
uriString = ENV['MONGOSOUP_URL']
client = MongoClient.from_uri(uriString)
db = client.db('myDbName')
db.myCollection.each { ... }
```

## Upgrading to a larger MongoSoup plan

Currently, you can only automatically change to another plan within the shared environment. Moving to smaller plans will only work if your data will fit into the smaller plan's limit. 

There are steps to follow if you've outgrown or anticipate outgrowing your current dedicated plan. First, stop your app and any other processes running against your database. Then:

* Backup your database 
* Remove your existing Add-on 
* Add a new Add-on (see available plans here) 
* Restore your database 
* Redeploy your app

Providing you're using the MongoSoup_URI from your CRED_FILE, no application changes are required.

## Removing MongoSoup

If you'd like to remove the MongoSoup add-on, use the cctrlapp command line:

~~~
$ cctrlapp APP_NAME/DEP_NAME addon.remove mongosoup.OPTION
~~~

Note: All data in your database will be lost if you remove the MongoSoup add-on.
